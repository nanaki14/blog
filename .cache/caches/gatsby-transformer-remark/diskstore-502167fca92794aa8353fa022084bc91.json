{"expireTime":9007200819755980000,"key":"transformer-remark-markdown-ast-8df4e55a0f35cbf2f680134f2f8ef5aa-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"こんにちわ、ななきです。","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":13,"offset":12},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":13,"offset":12},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"最近Nextを触ることが多かったので、webpack周りのプラグインの追加だったりgzip対応について書いてみたいと思います。","position":{"start":{"line":3,"column":1,"offset":14},"end":{"line":3,"column":64,"offset":77},"indent":[]}}],"position":{"start":{"line":3,"column":1,"offset":14},"end":{"line":3,"column":64,"offset":77},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"多分このへんはサービス運用するにあたってTS化したり速度改善したりと必要になってくるので目を通しておいて損はないと思います。","position":{"start":{"line":5,"column":1,"offset":79},"end":{"line":5,"column":63,"offset":141},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":79},"end":{"line":5,"column":63,"offset":141},"indent":[]}},{"type":"html","value":"<h2>プラグインの追加</h2>","position":{"start":{"line":7,"column":1,"offset":143},"end":{"line":7,"column":18,"offset":160},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<a href=\"https://github.com/zeit/next-plugins\" target=\"_blank\">","position":{"start":{"line":9,"column":1,"offset":162},"end":{"line":9,"column":64,"offset":225},"indent":[]}},{"type":"text","value":"Nextのプラグイン","position":{"start":{"line":9,"column":64,"offset":225},"end":{"line":9,"column":74,"offset":235},"indent":[]}},{"type":"html","value":"</a>","position":{"start":{"line":9,"column":74,"offset":235},"end":{"line":9,"column":78,"offset":239},"indent":[]}},{"type":"text","value":"は結構豊富です。","position":{"start":{"line":9,"column":78,"offset":239},"end":{"line":9,"column":86,"offset":247},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":162},"end":{"line":9,"column":86,"offset":247},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"私はこの中でTypeScriptとbundle-analyzerを使う機会がありました。","position":{"start":{"line":11,"column":1,"offset":249},"end":{"line":11,"column":45,"offset":293},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":249},"end":{"line":11,"column":45,"offset":293},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"通常一つプラグインを追加する場合は下記のように書くようです。","position":{"start":{"line":13,"column":1,"offset":295},"end":{"line":13,"column":31,"offset":325},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":295},"end":{"line":13,"column":31,"offset":325},"indent":[]}},{"type":"html","lang":"next.config.js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"next.config.js\"><pre class=\"language-next.config.js\"><code class=\"language-next.config.js\">const withTypescript = require(&#39;@zeit/next-typescript&#39;)\n\nmodule.exports = withTypescript({\n  // webpackとかの記述\n})</code></pre></div>","position":{"start":{"line":15,"column":1,"offset":327},"end":{"line":21,"column":4,"offset":460},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"ただ、これだと複数のプラグイン使う場合どうするのって感じですよね。","position":{"start":{"line":23,"column":1,"offset":462},"end":{"line":23,"column":34,"offset":495},"indent":[]}}],"position":{"start":{"line":23,"column":1,"offset":462},"end":{"line":23,"column":34,"offset":495},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"複数使う場合はコミュニティプラグインの","position":{"start":{"line":25,"column":1,"offset":497},"end":{"line":25,"column":20,"offset":516},"indent":[]}},{"type":"html","value":"<a href=\"https://github.com/cyrilwanner/next-compose-plugins\" target=\"_blank\">","position":{"start":{"line":25,"column":20,"offset":516},"end":{"line":25,"column":98,"offset":594},"indent":[]}},{"type":"text","value":"next-compose-plugins","position":{"start":{"line":25,"column":98,"offset":594},"end":{"line":25,"column":118,"offset":614},"indent":[]}},{"type":"html","value":"</a>","position":{"start":{"line":25,"column":118,"offset":614},"end":{"line":25,"column":122,"offset":618},"indent":[]}},{"type":"text","value":"を使うか下記のような書き方をするようです。","position":{"start":{"line":25,"column":122,"offset":618},"end":{"line":25,"column":143,"offset":639},"indent":[]}}],"position":{"start":{"line":25,"column":1,"offset":497},"end":{"line":25,"column":143,"offset":639},"indent":[]}},{"type":"html","lang":"next.config.js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"next.config.js\"><pre class=\"language-next.config.js\"><code class=\"language-next.config.js\">const withTypescript = require(&#39;@zeit/next-typescript&#39;)\nconst withBundleAnalyzer = require(&#39;@zeit/next-bundle-analyzer&#39;)\n\nmodule.exports = withTypescript(\n  withBundleAnalyzer({\n    analyzeServer: [&#39;server&#39;, &#39;both&#39;].includes(process.env.BUNDLE_ANALYZE),\n      analyzeBrowser: [&#39;browser&#39;, &#39;both&#39;].includes(process.env.BUNDLE_ANALYZE),\n      bundleAnalyzerConfig: {\n        server: {\n          analyzerMode: &#39;static&#39;,\n          reportFilename: &#39;../bundles/server.html&#39;\n        },\n        browser: {\n          analyzerMode: &#39;static&#39;,\n          reportFilename: &#39;../bundles/client.html&#39;\n        }\n      },\n      {\n        // webpackとかの記述\n      }\n  })\n)</code></pre></div>","position":{"start":{"line":27,"column":1,"offset":641},"end":{"line":50,"column":4,"offset":1310},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"２つ３つであればこのように入れ子でもいいかもしれませんが可読性が良くないので状況に応じてnext-compose-pluginsを使用するほうがいいかもしれませんね。","position":{"start":{"line":52,"column":1,"offset":1312},"end":{"line":52,"column":84,"offset":1395},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":1312},"end":{"line":52,"column":84,"offset":1395},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"ちなみに上記の設定だとbundle-analyzerは下記コマンドで実行します。","position":{"start":{"line":54,"column":1,"offset":1397},"end":{"line":54,"column":41,"offset":1437},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":1397},"end":{"line":54,"column":41,"offset":1437},"indent":[]}},{"type":"html","lang":null,"meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">BUNDLE_ANALYZE=both next build</code></pre></div>","position":{"start":{"line":56,"column":1,"offset":1439},"end":{"line":58,"column":4,"offset":1477},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"そしてTypeScriptに関してはtsconfigの用意とbabelrcに下記の追加で動いてしまいます。","position":{"start":{"line":60,"column":1,"offset":1479},"end":{"line":60,"column":54,"offset":1532},"indent":[]}}],"position":{"start":{"line":60,"column":1,"offset":1479},"end":{"line":60,"column":54,"offset":1532},"indent":[]}},{"type":"html","lang":null,"meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;presets&quot;: [\n  &quot;@zeit/next-typescript/babel&quot;\n],</code></pre></div>","position":{"start":{"line":62,"column":1,"offset":1534},"end":{"line":66,"column":4,"offset":1589},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"便利な世の中ですね","position":{"start":{"line":68,"column":1,"offset":1591},"end":{"line":68,"column":10,"offset":1600},"indent":[]}}],"position":{"start":{"line":68,"column":1,"offset":1591},"end":{"line":68,"column":10,"offset":1600},"indent":[]}},{"type":"html","value":"<h2>gzip対応</h2>","position":{"start":{"line":70,"column":1,"offset":1602},"end":{"line":70,"column":16,"offset":1617},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"これはびっくりするほど簡単でした。","position":{"start":{"line":72,"column":1,"offset":1619},"end":{"line":72,"column":18,"offset":1636},"indent":[]}}],"position":{"start":{"line":72,"column":1,"offset":1619},"end":{"line":72,"column":18,"offset":1636},"indent":[]}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">yarn add compression</code>","position":{"start":{"line":74,"column":1,"offset":1638},"end":{"line":74,"column":23,"offset":1660},"indent":[]}},{"type":"text","value":" をして、下記の様にserver.jsに記述するだけです。","position":{"start":{"line":74,"column":23,"offset":1660},"end":{"line":74,"column":52,"offset":1689},"indent":[]}}],"position":{"start":{"line":74,"column":1,"offset":1638},"end":{"line":74,"column":52,"offset":1689},"indent":[]}},{"type":"html","lang":"server.js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"server.js\"><pre class=\"language-server.js\"><code class=\"language-server.js\">const express = require(&#39;express&#39;)\nconst compression = require(&#39;compression&#39;)\n\nconst server = express()\nserver.use(compression())</code></pre></div>","position":{"start":{"line":76,"column":1,"offset":1691},"end":{"line":82,"column":4,"offset":1837},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"ちなみにホスティングがGCPで、設定については","position":{"start":{"line":84,"column":1,"offset":1839},"end":{"line":84,"column":24,"offset":1862},"indent":[]}},{"type":"html","value":"<a href=\"https://nanaki.design/javascript/next-js/\">","position":{"start":{"line":84,"column":24,"offset":1862},"end":{"line":84,"column":76,"offset":1914},"indent":[]}},{"type":"text","value":"以前書いた記事","position":{"start":{"line":84,"column":76,"offset":1914},"end":{"line":84,"column":83,"offset":1921},"indent":[]}},{"type":"html","value":"</a>","position":{"start":{"line":84,"column":83,"offset":1921},"end":{"line":84,"column":87,"offset":1925},"indent":[]}},{"type":"text","value":"を参考にしてください。","position":{"start":{"line":84,"column":87,"offset":1925},"end":{"line":84,"column":98,"offset":1936},"indent":[]}}],"position":{"start":{"line":84,"column":1,"offset":1839},"end":{"line":84,"column":98,"offset":1936},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"gzip対応したらスピードテストのスコアがそれぞれ10前後伸びたので対応しておいて損はなさそうです。","position":{"start":{"line":86,"column":1,"offset":1938},"end":{"line":86,"column":51,"offset":1988},"indent":[]}}],"position":{"start":{"line":86,"column":1,"offset":1938},"end":{"line":86,"column":51,"offset":1988},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"初めてちゃんとgzip学びましたがすごいです（すごいです）","position":{"start":{"line":88,"column":1,"offset":1990},"end":{"line":88,"column":30,"offset":2019},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":1990},"end":{"line":88,"column":30,"offset":2019},"indent":[]}},{"type":"html","value":"<h2>まとめ</h2>","position":{"start":{"line":90,"column":1,"offset":2021},"end":{"line":90,"column":13,"offset":2033},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Nextは英語の情報多めなので少し情報追うのが大変ですが、やりたいことは多少頑張ればできる感じですね。","position":{"start":{"line":92,"column":1,"offset":2035},"end":{"line":92,"column":52,"offset":2086},"indent":[]}}],"position":{"start":{"line":92,"column":1,"offset":2035},"end":{"line":92,"column":52,"offset":2086},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"今後もNextで開発してく機会があるので適宜まとめていきます。","position":{"start":{"line":94,"column":1,"offset":2088},"end":{"line":94,"column":32,"offset":2119},"indent":[]}}],"position":{"start":{"line":94,"column":1,"offset":2088},"end":{"line":94,"column":32,"offset":2119},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":94,"column":32,"offset":2119}}}}