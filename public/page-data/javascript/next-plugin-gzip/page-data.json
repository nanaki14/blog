{"componentChunkName":"component---src-templates-blog-post-js","path":"/javascript/next-plugin-gzip/","webpackCompilationHash":"adf4fdbe78722057ff87","result":{"data":{"site":{"siteMetadata":{"title":"Mix Design","author":"nanaki"}},"markdownRemark":{"id":"9b23fe88-0bf5-513d-a245-7c6af15b0169","excerpt":"こんにちわ、ななきです。 最近Nextを触ることが多かったので、webpack周りのプラグインの追加だったりgzip対応について書いてみたいと思います。 多分このへんはサービス運用するにあたってTS化したり速度改善したりと必要になってくるので目を通しておいて損はないと思います。 Next…","html":"<p>こんにちわ、ななきです。</p>\n<p>最近Nextを触ることが多かったので、webpack周りのプラグインの追加だったりgzip対応について書いてみたいと思います。</p>\n<p>多分このへんはサービス運用するにあたってTS化したり速度改善したりと必要になってくるので目を通しておいて損はないと思います。</p>\n<h2>プラグインの追加</h2>\n<p><a href=\"https://github.com/zeit/next-plugins\" target=\"_blank\">Nextのプラグイン</a>は結構豊富です。</p>\n<p>私はこの中でTypeScriptとbundle-analyzerを使う機会がありました。</p>\n<p>通常一つプラグインを追加する場合は下記のように書くようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"next.config.js\"><pre class=\"language-next.config.js\"><code class=\"language-next.config.js\">const withTypescript = require(&#39;@zeit/next-typescript&#39;)\n\nmodule.exports = withTypescript({\n  // webpackとかの記述\n})</code></pre></div>\n<p>ただ、これだと複数のプラグイン使う場合どうするのって感じですよね。</p>\n<p>複数使う場合はコミュニティプラグインの<a href=\"https://github.com/cyrilwanner/next-compose-plugins\" target=\"_blank\">next-compose-plugins</a>を使うか下記のような書き方をするようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"next.config.js\"><pre class=\"language-next.config.js\"><code class=\"language-next.config.js\">const withTypescript = require(&#39;@zeit/next-typescript&#39;)\nconst withBundleAnalyzer = require(&#39;@zeit/next-bundle-analyzer&#39;)\n\nmodule.exports = withTypescript(\n  withBundleAnalyzer({\n    analyzeServer: [&#39;server&#39;, &#39;both&#39;].includes(process.env.BUNDLE_ANALYZE),\n      analyzeBrowser: [&#39;browser&#39;, &#39;both&#39;].includes(process.env.BUNDLE_ANALYZE),\n      bundleAnalyzerConfig: {\n        server: {\n          analyzerMode: &#39;static&#39;,\n          reportFilename: &#39;../bundles/server.html&#39;\n        },\n        browser: {\n          analyzerMode: &#39;static&#39;,\n          reportFilename: &#39;../bundles/client.html&#39;\n        }\n      },\n      {\n        // webpackとかの記述\n      }\n  })\n)</code></pre></div>\n<p>２つ３つであればこのように入れ子でもいいかもしれませんが可読性が良くないので状況に応じてnext-compose-pluginsを使用するほうがいいかもしれませんね。</p>\n<p>ちなみに上記の設定だとbundle-analyzerは下記コマンドで実行します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">BUNDLE_ANALYZE=both next build</code></pre></div>\n<p>そしてTypeScriptに関してはtsconfigの用意とbabelrcに下記の追加で動いてしまいます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;presets&quot;: [\n  &quot;@zeit/next-typescript/babel&quot;\n],</code></pre></div>\n<p>便利な世の中ですね</p>\n<h2>gzip対応</h2>\n<p>これはびっくりするほど簡単でした。</p>\n<p><code class=\"language-text\">yarn add compression</code> をして、下記の様にserver.jsに記述するだけです。</p>\n<div class=\"gatsby-highlight\" data-language=\"server.js\"><pre class=\"language-server.js\"><code class=\"language-server.js\">const express = require(&#39;express&#39;)\nconst compression = require(&#39;compression&#39;)\n\nconst server = express()\nserver.use(compression())</code></pre></div>\n<p>ちなみにホスティングがGCPで、設定については<a href=\"https://nanaki.design/javascript/next-js/\">以前書いた記事</a>を参考にしてください。</p>\n<p>gzip対応したらスピードテストのスコアがそれぞれ10前後伸びたので対応しておいて損はなさそうです。</p>\n<p>初めてちゃんとgzip学びましたがすごいです（すごいです）</p>\n<h2>まとめ</h2>\n<p>Nextは英語の情報多めなので少し情報追うのが大変ですが、やりたいことは多少頑張ればできる感じですね。</p>\n<p>今後もNextで開発してく機会があるので適宜まとめていきます。</p>","frontmatter":{"title":"Nextにプラグイン追加したりgzip対応した話","date":"May 15, 2019","description":"最近Nextを触ることが多かったので、webpack周りのプラグインの追加だったりgzip対応について書いてみたいと思います。","category":"javascript","thumb":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5UlEQVQoz72Syw5EQBBFfY8F06Y94j0JYUG8goiQ2Fjb+AI/PjfdiQwxq5mohVSl79G3LsLzhxL+BiuKwpsHK4yUUkKIYRiE1VcYOi5SVfXFyrIsSZKCIMiyzPd90zT3tx9gMJCu6woS6nmeoyhq2zZN06IomqZZlsV1Xe7lDMOk4zjTNCVJAgxwGIa6rm/bZts2mrquRVH8JA+w53lQQDqO4zAMGKuq6roOT/RwAWs4urgZfjRNgzEsWZZl3/d5nsdxjBHLY1t+PwTXgYHnefLkgMmyzOPYj06BX39nyurGn+RW+A3HDaoU1Q7N8gAAAABJRU5ErkJggg==","aspectRatio":1.5,"src":"/static/74ed918c868cc6e3e11f486880c430ef/af144/next-plugin-gzip.png","srcSet":"/static/74ed918c868cc6e3e11f486880c430ef/7c0ed/next-plugin-gzip.png 200w,\n/static/74ed918c868cc6e3e11f486880c430ef/647de/next-plugin-gzip.png 400w,\n/static/74ed918c868cc6e3e11f486880c430ef/af144/next-plugin-gzip.png 800w,\n/static/74ed918c868cc6e3e11f486880c430ef/ba299/next-plugin-gzip.png 1200w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/next-plugin-gzip/","previous":{"fields":{"slug":"/gtm-ga-title/"},"frontmatter":{"title":"Nuxt + Vuexでサクッとポートフォリオ作ってみた","category":"javascript"}},"next":{"fields":{"slug":"/react-redx-hooks/"},"frontmatter":{"title":"react-reduxのHooksAPI触ってみた","category":"javascript"}}}}}